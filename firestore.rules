rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Allow authenticated users to read all user profiles and update their own
    match /users/{uid} {
      allow read: if request.auth != null;
      allow update: if request.auth.uid == uid || request.auth != null;
      allow write: if request.auth.uid == uid;
    }

    // Version 3.0 collections only

    // Users
    match /users/{uid} {
      allow read: if request.auth != null;
      allow update: if request.auth.uid == uid || request.auth != null;
      allow write: if request.auth.uid == uid;
    }

    // On-premise daily headcount (per shift)
    match /onPremiseData/{document=**} {
      allow read, write: if request.auth != null;
    }

    // Hours data (per day, per shift)
    match /hoursData/{document=**} {
      allow read, write: if request.auth != null;
    }

    // Branch / recruiter daily metrics
    match /branchMetrics/{document=**} {
      allow read, write: if request.auth != null;
    }

    // Early leave incidents
    match /earlyLeaves/{document=**} {
      allow read, write: if request.auth != null;
    }

    // Associates (single source of truth for people)
    match /associates/{document=**} {
      allow read, write: if request.auth != null;
    }

    // Badges
    match /badges/{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
